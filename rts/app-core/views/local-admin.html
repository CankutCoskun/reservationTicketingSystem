<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap-resources/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap-resources/stylesheets/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <title>Local Admin</title>

    <script>

    </script>
</head>

<body>
    <header>
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark shadow-sm">
            <img src="<%=logoPath%>" class="d-inline-block align-center" alt="" width="120" height="60">
            <h5 class="modal-title" id="title" style="color: white; border-color: white; margin-left: 20px;">
                <%= compname %>
            </h5>
            <div class="collapse navbar-collapse" id="navbarColor02">
                <ul class="nav navbar-nav navbar-right ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/logout" style="color: white;"><i class="fa fa-fw fa-sign-out"></i>
                            Logout</a>
                    </li>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main role="main" class="">

        <div class=" container" style="margin-top: 100px;">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal"
                style="margin: 15px; background-color: #0d5abe;">
                Add Event
            </button>

            <!-- Add Event Modal -->
            <div class="modal fade" id="addModal" data-backdrop="static" tabindex="-1" role="dialog"
                aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Add Event</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form action="/api/events/add" enctype="multipart/form-data" method="POST">
                                <div class="form-group">
                                    <label for="EventInformation">Event Title</label>
                                    <input type="text" class="form-control" name="eventtitle" id="eventtitle"
                                        placeholder="Event Title" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Venue ID</label>
                                    <input type="text" class="form-control" name="eventvenue" id="eventvenue"
                                        placeholder="Event Venue" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Date</label>
                                    <input type="date" class="form-control" name="eventdate" id="eventdate"
                                        placeholder="Event Date" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Time</label>
                                    <input type="time" class="form-control" name="eventtime" id="eventtime"
                                        placeholder="Event Time" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Type</label>
                                        <select type="text" class="form-control" name="eventtype" id="eventtype" required>
                                            <option value ="CONCERT">CONCERT</option>
                                            <option value ="THEATRE">THEATRE</option>
                                            <option value ="DANCE">DANCE</option>
                                            <option value ="STANDUP">STANDUP</option>
                                            <option value ="OPERA">OPERA</option>
                                            <option value ="MUSICAL">MUSICAL</option>
                                            <option value ="BALLET">BALLET</option>
                                            </select> 
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Detail</label>
                                    <input type="text" class="form-control" name="eventdetail" id="eventdetail"
                                        placeholder="Event Detail" required>
                                </div>
                                <div class="form-group">
                                    <h4 class="modal-title">Upload Image</h5>
                                        <input type="file" name="myFile" class="form-control-file"
                                            id="exampleFormControlFile1">
                                </div>
                                <input type="number" name="compid" value="<%= compid %>" style="display:none;"> 
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <input type='submit' name='addevent' class="btn btn-primary  active" role="button"
                                        aria-pressed="true" value="Add New Event">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!--Add Venue Modal -->
            <div class="modal fade" id="addVenue" data-backdrop="static" tabindex="-1" role="dialog"
                aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Add Venue</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="/api/venues/add" enctype="multipart/form-data" method="POST">
                                <div class="form-group">
                                    <label for="vname">Venue Name</label>
                                    <input type="text" class="form-control" name="vname" id="vname"
                                        placeholder="Venue Name" required>
                                </div>

                                <div class="form-group">
                                    <label for="vname">Venue Capacity</label>
                                    <input type="number" class="form-control" name="vcap" id="vcap"
                                        placeholder="Venue Capacity" required>
                                </div>

                                <div class="form-group">
                                    <h4 class="modal-title">Upload Image</h5>
                                        <input type="file" name="myFile" class="form-control-file"
                                            id="exampleFormControlFile1">
                                </div>
                                <input type="number" name="compid" value="<%= compid %>" style="display:none;"> 

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <input type='submit' name='addVenue' class="btn btn-primary  active" role="button"
                                        aria-pressed="true" value="Add New Venue">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="updateVenue" data-backdrop="static" tabindex="-1" role="dialog"
                aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Update Venue</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form action="/api/venues/update" enctype="multipart/form-data" method="POST">
                                <div class="form-group">
                                    <label for="EventInformation">Venue Name</label>
                                    <input type="text" class="form-control" name="vname2" id="vname"
                                        placeholder="Venue Name" required>
                                </div>

                                <div class="form-group">
                                    <h4 class="modal-title">Upload Image</h5>
                                        <input type="file" name="myFile2" class="form-control-file"
                                            id="exampleFormControlFile1">
                                </div>
                                <input type="number" name="compid2" value="<%= compid %>" style="display:none;"> 
                                <input type="number" name="vid2" style="display:none;">
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <input type='submit' name='updatevenue' class="btn btn-primary  active"
                                        role="button" aria-pressed="true" value="Update Venue">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal for Edit Event-->
            <div class="modal fade" id="updateModal" data-backdrop="static" tabindex="-1" role="dialog"
                aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Update Event</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form action="/api/events/update/" enctype="multipart/form-data" method="POST">
                                <div class="form-group">
                                    <label for="EventInformation">Event Title</label>
                                    <input type="text" class="form-control" name="eventtitle2" id="eventtitle2"
                                        placeholder="Event Title" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Venue</label>
                                    <input type="text" class="form-control" name="eventvenue2" id="eventvenue2"
                                        placeholder="Event Venue" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Date</label>
                                    <input type="text" class="form-control" name="eventdate2" id="eventdate2"
                                        placeholder="Event Date" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Time</label>
                                    <input type="text" class="form-control" name="eventtime2" id="eventtime2"
                                        placeholder="Event Time" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Capacity</label>
                                    <input type="number" class="form-control" name="eventcapacity2" id="eventcapacity2"
                                        placeholder="Event Capacity" required>
                                </div>
                                <div class="form-group">
                                    <label for="EventInformation">Event Detail</label>
                                    <input type="text" class="form-control" name="eventdetail2" id="eventdetail2"
                                        placeholder="Event Detail" required>
                                </div>
                                <!-- <div class="form-group">
                            <h4 class="modal-title">Upload Image</h5>
                                <input type="file" name="myFile" class="form-control-file"
                                    id="exampleFormControlFile1">
                        </div> -->

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <input type='submit' name='updateevent' class="btn btn-primary  active"
                                        role="button" aria-pressed="true" value="Update Event">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <table id=eventtable class="table table-striped">
                <thead>
                    <tr>
                        <!--  <th scope="col">Company Image</th> -->
                        <th scope="col">Event ID</th>
                        <th scope="col">Event Title</th>
                        <th scope="col">Event Venue</th>
                        <th scope="col">Event Date</th>
                        <th scope="col">Event Time</th>
                        <th scope="col">Event Type</th>
                        <th scope="col">Event Detail</th>

                    </tr>
                </thead>
                <tbody id="events">
                    <% for(var i=0; i < events.length; i++) { %>
                    <tr>
                        <td><%= events[i].eId %></td>
                        <td><%= events[i].title %></td>
                        <td><%= events[i].venueId %></td>
                        <td><%= events[i].date %></td>
                        <td><%= events[i].time %></td>
                        <td><%= events[i].eType %></td>
                        <td><%= events[i].detail %></td>
                        <td>
                            <input type='submit' name='edit' class='btn btn-sm btn-info' role='button' value='Edit'
                                id="a"
                                onclick="updateFunc(<%= events[i].eId %>,'<%= events[i].title %>','<%= events[i].venue %>','<%= events[i].date %>','<%= events[i].time %>',<%= events[i].capacity %>,'<%= events[i].detail %>')">
                            <input type='submit' name='delete' class='btn btn-sm btn-danger' role='button'
                                value='Delete' onclick="deleteFunc(<%= events[i].eId %>)">
                        </td>
                    </tr>
                    <% } %>

                </tbody>
            </table>

            <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#addVenue"
                style="margin: 15px;">
                Add Venue
            </button>

            <table id=venuetable class="table table-striped">

                <thead id="venues">
                    <tr>
                        <!--  <th scope="col">Company Image</th> -->
                        <th scope="col">Venue ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Capacity</th>
                        <th scope="col">Seating Plan</th>
                    </tr>
                </thead>

                <tbody id="venues">

                    <% for( var i=0; i < venues.length; i++) { %>
                    <tr>
                        <td><%= venues[i].vid %></td>
                        <td><%= venues[i].name %></td>
                        <td><%= venues[i].vcapacity %></td>

                        <td style="text-align: center;" class="w-25">
                            <a href="<%= venues[i].imagePath %>"><img src="<%= venues[i].imagePath%>"
                                    class="img-fluid img-thumbnail"></a>
                        </td>

                        <td>
                            <div class="container">
                                <a href="#demo" class="btn btn-primary" data-toggle="collapse"
                                    style="background-color: #0d5abe; height: 35px;"
                                    onclick="displayCategories(<%= venues[i].vid %>)">
                                    Display Categories
                                </a>

                                <div id="demo" class="collapse">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">name</th>
                                                <th scope="col">capacity</th>
                                            </tr>
                                        </thead>
                                        <tbody id="categories">
                                            <!--
                                                DYNAMICALLY FILLED
                                            -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </td>

                        <td>
                            <form action="" id="needs-validation" novalidate>
                                <div class="form-row">
                                    <div class="form-group col-md-3">
                                        <input type="number" name="" class="input form-control" id="cnum"
                                            style="width: 60px;" required>
                                    </div>
                                    <div class="form-group col-md-9">
                                        <div class="text-md-left">
                                            <!-- Button trigger modal -->
                                            <button id="cbtn" type="submit" class="btn btn-dark generate"
                                                data-toggle="modal" data-target="#exampleModal">
                                                Add Category
                                            </button>
                                        </div>
                                    </div>
                            </form>
                            <!-- Modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <form action="/api/venues/category/add/<%= venues[i].vid %>" method="POST">
                                            <div class="modal-body">
                                                <div id="forms">
                                                    <!--
                                                            CATEGORY FORM DYNAMICALLY CREATED
                                                        -->
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <input type='submit' name='delete' class='btn btn-sm btn-danger' role='button'
                                value='Delete' onclick="deleteVenue(<%= venues[i].vid %>)" style='height: 35px;'>
                        </td>
                    </tr>
                    <% } %>

                </tbody>
            </table>
        </div>

    </main>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#cbtn').click(function (e) {
                e.preventDefault();
                let input = $('#cnum').val();
                let temp_html = '';
                for (i = 0; i < input; i++) {
                    temp_html +=
                        '<div class="row">\n' +
                        '<div class="col-md-4">\n' +
                        '<div class="form-group">\n' +
                        '<label>Category Name</label>\n' +
                        '<input type="text" name="name" class="form-control" placeholder="name" required="">\n' +
                        '</div>\n' +
                        '</div>\n' +
                        '<div class="col-md-4">\n' +
                        '<div class="form-group">\n' +
                        '<label> Capacity</label>\n' +
                        '<input type="number" name="ccapacity" class="form-control" placeholder="capacity" required="">\n' +
                        '</div>\n' +
                        '</div>\n' +
                        '</div>';
                }
                $('#forms').append(temp_html);
            });
        }); 
    </script>

    <script>

        function deleteFunc(eId) {

            var xmlhttp = new XMLHttpRequest();
            var a = "/api/events/delete/" + String(eId);
            xmlhttp.open("DELETE", a, true);
            xmlhttp.send();
            window.location.reload();
        }

        function deleteVenue(vid) {
            var xmlhttp = new XMLHttpRequest();
            var a = "/api/venues/delete/" + String(vid);
            xmlhttp.open("DELETE", a, true);
            xmlhttp.send();
            window.location.reload();
        }

        function addCategory(vid) {
            //NOT USED
            var xmlhttp = new XMLHttpRequest();
            var targetApi = "/api/venues/category/add/" + String(vid);
            xmlhttp.open("POST", targetApi, true);
            xmlhttp.send();
            window.location.reload();
        }

        function displayCategories(vid) {
            var xmlhttp = new XMLHttpRequest();

            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {

                    const data = JSON.parse(this.responseText);
                    console.log(data);
                    var table_body = document.getElementById('categories');

                    data.forEach(function (category) {
                        console.log(category);
                        var row = document.createElement('tr');
                        var id = document.createElement('td');
                        id.innerText = category.categoryid;
                        var name = document.createElement('td');
                        name.innerText = category.cname;
                        var capacity = document.createElement('td');
                        capacity.innerText = category.ccapacity;
                        row.appendChild(id);
                        row.appendChild(name);
                        row.appendChild(capacity);
                        table_body.appendChild(row);
                    });
                }
            };

            var targetApi = "/api/venues/category/all/" + String(vid);
            xmlhttp.open("GET", targetApi, true);
            xmlhttp.send();

        }

        function updateFunc(eId, title, venue, date, time, capacity, detail) {
            var myModal = $('#updateModal');
            $("#eventtitle2", myModal).val(title);
            $("#eventvenue2", myModal).val(venue);
            $("#eventdate2", myModal).val(date);
            $("#eventtime2", myModal).val(time);
            $("#eventcapacity2", myModal).val(capacity);
            $("#eventdetail2", myModal).val(detail);
            //$("#eventid", myModal).val(eId);
            $('#updateModal').modal('show');
        }

        function updateVenue(vid, name) {
            var myModal2 = $('#updateVenue');
            $("#vid2", myModal2).val(vid);
            $("#vname2", myModal2).val(name);
            //$("#eventid", myModal).val(eId);
            $('#updateVenue').modal('show');
        }

    </script>

</body>

</html>